<!DOCTYPE html>
<html lang="EN">
    <head>
        <meta charset="utf-8">
        <title>Geo Choropleth Chart</title>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.1/d3.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.9/dc.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.9/dc.min.css" />
    </head>
    <body>
        <h1>Geo Choropleth Chart: US Venture Capital Landscape 2011</h1>
        <div id="geoChoroplethChart"></div>

        <script type="text/javascript">
            // https://raw.githubusercontent.com/dc-js/dc.js/develop/web/vc/vc.csv
            // https://raw.githubusercontent.com/dc-js/dc.js/develop/web/geo/us-states.json
            d3.csv("vc.csv", function (error, csvData) {

                console.log(csvData);

                csvData.forEach(function (d) {
                    d.Raised = +d.Raised
                });

                var facts = crossfilter(csvData);

                var dimensionByState = facts.dimension(function (d) {
                    return d.State
                })
                var groupByRaised = dimensionByState.group().reduceSum(function (d) {
                    return d.Raised
                });

                d3.json("us-states.json", function (error, jsonData) {
                    console.log(jsonData);

                    var centre = d3.geo.centroid(jsonData);
                    var projection = d3.geo.mercator().center(centre).scale(500).translate([200, 100]);


                    var geoChoroplethChart = dc.geoChoroplethChart("#geoChoroplethChart")
                            .width(1024)
                            .height(600)
                            .dimension(dimensionByState)
                            .projection(projection)
                            .group(groupByRaised)
                            .overlayGeoJson(jsonData.features, "State", function (d) {
                                return d.properties.name;
                            })
                            .colors(d3.scale.quantize().range(["#E2F2FF", "#C4E4FF", "#9ED2FF", "#81C5FF", "#6BBAFF", "#51AEFF", "#36A2FF", "#1E96FF", "#0089FF", "#0061B5"]))
                            .colorDomain([0, 200])
                            .colorCalculator(function (d) {
                                return d ? geoChoroplethChart.colors()(d) : '#ccc';
                            });
                    dc.renderAll();

                });

            });

        </script>

    </body>
</html>